-- ============================================================
-- Problem: Exercise 3 - Advanced Features (Library Management System)
-- File: LibraryManagement.db
-- Table: books, students, borrow_records
-- Database: libraray_db
-- ============================================================

// creating database for library
mysql> CREATE DATABASE libraray_db;

/*		OUTPUT
Query OK, 1 row affected (0.01 sec)
*/

// switching to use library database
mysql> USE libraray_db;

/*		OUTPUT
Database changed
*/

// creating table books
mysql> CREATE TABLE books (
         	book_id INT PRIMARY KEY AUTO_INCREMENT,
         	title VARCHAR(100),
         	author VARCHAR(100),
         	category VARCHAR(50),
         	total_copies INT,
         	available_copies INT
     	);
Query OK, 0 rows affected (0.01 sec)

// creating table students
mysql> CREATE TABLE students (
    ->     student_id INT PRIMARY KEY AUTO_INCREMENT,
    ->     name VARCHAR(100),
    ->     department VARCHAR(50)
    -> );
    
/*		OUTPUT
Query OK, 0 rows affected (0.03 sec)
*/

// creating table borrow_records
mysql> CREATE TABLE borrow_records (
       		record_id INT PRIMARY KEY AUTO_INCREMENT,
        	student_id INT,
         	book_id INT,
         	borrow_date DATE,
         	return_date DATE,
         	fine DECIMAL(6,2),
         	FOREIGN KEY (student_id) REFERENCES students(student_id),
         	FOREIGN KEY (book_id) REFERENCES books(book_id)
     	);
     	
/*		OUTPUT
Query OK, 0 rows affected (0.03 sec)
*/

// inserting values into books table
mysql> INSERT INTO books (title, author, category, total_copies, available_copies)
    		VALUES
    		('Database Systems', 'Elmasri', 'Technology', 5, 5),
    		('Operating Systems', 'Silberschatz', 'Technology', 4, 4),
    		('Clean Code', 'Robert Martin', 'Programming', 3, 3);

/*		OUTPUT
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0
*/

mysql> SELECT * FROM books;

/*		OUTPUT
+---------+-------------------+---------------+-------------+--------------+------------------+
| book_id | title             | author        | category    | total_copies | available_copies |
+---------+-------------------+---------------+-------------+--------------+------------------+
|       1 | Database Systems  | Elmasri       | Technology  |            5 |                5 |
|       2 | Operating Systems | Silberschatz  | Technology  |            4 |                4 |
|       3 | Clean Code        | Robert Martin | Programming |            3 |                3 |
+---------+-------------------+---------------+-------------+--------------+------------------+
3 rows in set (0.00 sec)
*/

// inserting data into students tables
mysql> INSERT INTO students (name, department)
    		VALUES
    		('Alice', 'CSE'),
    		('Bob', 'ECE');

/*		OUTPUT
Query OK, 2 rows affected (0.01 sec)
Records: 2  Duplicates: 0  Warnings: 0
*/

mysql> SELECT * FROM students;

/*		OUTPUT
+------------+-------+------------+
| student_id | name  | department |
+------------+-------+------------+
|          1 | Alice | CSE        |
|          2 | Bob   | ECE        |
+------------+-------+------------+
2 rows in set (0.00 sec)
*/

// inserting data into borrow_records
mysql> INSERT INTO borrow_records (student_id, book_id, borrow_date, return_date, fine)
    		VALUES (1, 1, '2025-02-01', NULL, 0);
    		
/*		OUTPUT
Query OK, 1 row affected (0.01 sec)
*/

// updating books 
mysql> UPDATE books
    		SET available_copies = available_copies - 1
    		WHERE book_id = 1;
    		
/*		OUTPUT
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0
*/

mysql> SELECT book_id, title, available_copies FROM books;

/*		OUTPUT
+---------+-------------------+------------------+
| book_id | title             | available_copies |
+---------+-------------------+------------------+
|       1 | Database Systems  |                4 |
|       2 | Operating Systems |                4 |
|       3 | Clean Code        |                3 |
+---------+-------------------+------------------+
3 rows in set (0.00 sec)
*/

// updating borrow records
mysql> UPDATE borrow_records
    		SET return_date = '2025-02-10',
    	    fine = DATEDIFF('2025-02-10', borrow_date) * 2
    		WHERE record_id = 1;

/*		OUTPUT
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0
*/

mysql> UPDATE books
    -> SET available_copies = available_copies + 1
    -> WHERE book_id = 1;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> SELECT * FROM borrow_records;
+-----------+------------+---------+-------------+-------------+-------+
| record_id | student_id | book_id | borrow_date | return_date | fine  |
+-----------+------------+---------+-------------+-------------+-------+
|         1 |          1 |       1 | 2025-02-01  | 2025-02-10  | 18.00 |
+-----------+------------+---------+-------------+-------------+-------+
1 row in set (0.00 sec)

mysql> SELECT title, author, category
    		FROM books
    		WHERE author LIKE '%Martin%'
    		AND category = 'Programming';
    		
/*		OUTPUT
+------------+---------------+-------------+
| title      | author        | category    |
+------------+---------------+-------------+
| Clean Code | Robert Martin | Programming |
+------------+---------------+-------------+
1 row in set (0.00 sec)
*/

mysql> SELECT title, available_copies
    		FROM books
    		WHERE available_copies > 0;
    		
/*		OUTPUT
+-------------------+------------------+
| title             | available_copies |
+-------------------+------------------+
| Database Systems  |                5 |
| Operating Systems |                4 |
| Clean Code        |                3 |
+-------------------+------------------+
3 rows in set (0.00 sec)
*/

mysql> SELECT s.name, b.title, br.borrow_date, br.return_date, br.fine
    		FROM borrow_records br
    		JOIN students s ON br.student_id = s.student_id
    		JOIN books b ON br.book_id = b.book_id;
    		
/*		OUTPUT
+-------+------------------+-------------+-------------+-------+
| name  | title            | borrow_date | return_date | fine  |
+-------+------------------+-------------+-------------+-------+
| Alice | Database Systems | 2025-02-01  | 2025-02-10  | 18.00 |
+-------+------------------------------------------------------
*/

