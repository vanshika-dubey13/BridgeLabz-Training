-- ============================================================
-- Problem: Exercise 2 - Transaction Management (Banking System)
-- File: TransactionManagement.db
-- Table: accounts, transactions
-- Database: employee_db
-- ============================================================


//	creating table accounts
mysql> CREATE TABLE accounts (
       		account_id INT PRIMARY KEY,
        	account_holder VARCHAR(100),
        	balance DECIMAL(12, 2) NOT NULL CHECK (balance >= 0)
     	); 
     	
/*		OUTPUT
Query OK, 0 rows affected (0.02 sec)
*/

//creating table transactions
mysql> CREATE TABLE transactions (
       		transaction_id SERIAL PRIMARY KEY,
        	from_account INT,
        	to_account INT,
        	amount DECIMAL(12, 2),
        	transaction_type VARCHAR(20),
         	transaction_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
         	FOREIGN KEY (from_account) REFERENCES accounts(account_id),
         	FOREIGN KEY (to_account) REFERENCES accounts(account_id)
     	);
     	
/*		OUTPUT
Query OK, 0 rows affected (0.03 sec)
*/

// inserting values into accounts table
mysql> INSERT INTO accounts (account_id, account_holder, balance)
     		VALUES
     		(1, 'Alice', 5000.00),
     		(2, 'Bob', 3000.00),
     		(3, 'Charlie', 2000.00);
     		
/*		OUTPUT
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0
*/

// inserting values into transactions table
mysql> INSERT INTO transactions (from_account, to_account, amount, transaction_type)
    		VALUES (1, 2, 500.00, 'TRANSFER');
    		
/*		OUTPUT
Query OK, 1 row affected (0.01 sec)
*/

// beginning transactions
mysql> BEGIN;

/*		OUTPUT
Query OK, 0 rows affected (0.00 sec)
*/

// updating transactions
mysql> UPDATE accounts
    		SET balance = balance - 500
     		WHERE account_id = 1;
     		
/*		OUTPUT
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0
*/

// updating accounts
mysql> UPDATE accounts
    		SET balance = balance + 500
    		WHERE account_id = 2;
    		
/*		OUTPUT
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0
*/

// updating transactions
mysql> INSERT INTO transactions (from_account, to_account, amount, transaction_type)
    		VALUES (1, 2, 500.00, 'TRANSFER');

/*		OUTPUT
Query OK, 1 row affected (0.00 sec)
*/

// commiting transaction
mysql> COMMIT;

/*		OUTPUT
Query OK, 0 rows affected (0.01 sec)
*/

mysql> INSERT INTO transactions (from_account, to_account, amount, transaction_type)
    		VALUES (NULL, 3, 1000.00, 'DEPOSIT');

/*		OUTPUT
Query OK, 1 row affected (0.00 sec)
*/

mysql> UPDATE accounts
    		SET balance = balance + 1000
    		WHERE account_id = 3;

/*		OUTPUT
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0
*/

mysql> UPDATE accounts
    		SET balance = balance - 300
   			WHERE account_id = 3;

/*		OUTPUT
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0
*/

mysql> SELECT * FROM accounts;

/*		OUTPUT
+------------+----------------+---------+
| account_id | account_holder | balance |
+------------+----------------+---------+
|          1 | Alice          | 4500.00 |
|          2 | Bob            | 3500.00 |
|          3 | Charlie        | 2700.00 |
+------------+----------------+---------+
3 rows in set (0.00 sec)
*/

mysql> SELECT * FROM transactions;

/*		OUTPUT
+----------------+--------------+------------+---------+------------------+---------------------+
| transaction_id | from_account | to_account | amount  | transaction_type | transaction_date    |
+----------------+--------------+------------+---------+------------------+---------------------+
|              1 |            1 |          2 |  500.00 | TRANSFER         | 2026-02-09 11:58:08 |
|              2 |            1 |          2 |  500.00 | TRANSFER         | 2026-02-09 11:59:06 |
|              3 |         NULL |          3 | 1000.00 | DEPOSIT          | 2026-02-09 11:59:37 |
|              4 |            3 |       NULL |  300.00 | WITHDRAWAL       | 2026-02-09 12:00:03 |
+----------------+--------------+------------+---------+------------------+---------------------+
4 rows in set (0.00 sec)
*/